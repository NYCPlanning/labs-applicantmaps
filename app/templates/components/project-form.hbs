<div class="cell sidebar">

  <h2 class="header-medium">Create New Project</h2>

  <label class="text-small">Project Title {{#unless model.projectName}}<strong class="red">{{fa-icon 'asterisk' transform='shrink-4'}}</strong>{{/unless}}
    {{input type="text" class='project-name-field' value=model.projectName}}
  </label>

  <label class="text-small">Applicant Name {{#unless model.applicantName}}<strong class="red">{{fa-icon 'asterisk' transform='shrink-4'}}</strong>{{/unless}}
    {{input type="text" class='applicant-name-field' value=model.applicantName}}
  </label>

  <label class="text-small">Project Number
    {{input type="text" class='zap-project-id-field' value=model.zapProjectId}}
  </label>

  <label class="text-small">Project Description
    {{textarea class='zap-project-description-field' value=model.description rows="3"}}
  </label>

  {{#if mapInstance}}
    {{#project-geometries-menu
      model=model
      mapInstance=mapInstance
      selectedLots=selectedLots
      lotSelectionMode=lotSelectionMode
      geometryMode=geometryMode
      as |menu|
    }}

      {{!-- Development Site --}}
      {{menu.draw-control
        mode="developmentSite"
        modeDisplayName="Development Site"
        hasGeom=model.developmentSite
        required=true
      }}

      {{!-- Project Area --}}
      {{#if model.developmentSite}}
        {{menu.draw-control
          mode="projectArea"
          modeDisplayName="Project Area"
          hasGeom=model.projectArea
        }}
      {{/if}}

      {{#if model.proposedZoning}}
        {{!-- Proposed Zoning --}}
        {{menu.draw-control
          mode="proposedZoning"
          modeDisplayName="Proposed Zoning"
          hasGeom=model.proposedZoning
        }}

        {{!-- Rezoning Area --}}
        {{menu.draw-control
          mode="rezoningArea"
          modeDisplayName="Rezoning Area"
          hasGeom=model.rezoningArea
        }}
      {{else}}
        {{!-- TODO Make this dependent on the existence of one or more geometries so we know what area to get zoning polygons for --}}
        <p class="text-right">
          <button type="button" class="button expanded small no-margin" disabled={{not model.developmentSite}} onclick={{action 'addProposedZoning'}}>
            {{fa-icon 'plus'}} Add Proposed Zoning Changes
          </button>
        </p>
      {{/if}}
    {{/project-geometries-menu}}
  {{/if}}

  <hr />

  <button type="button" class="button large green expanded project-save-button" disabled={{not model.isValid}} onclick={{action 'save' model}}>Save Project</button>

</div>
<div class="cell large-auto map-container">
  {{#project-map-form tagName='' as |projectMapForm|}}
    {{#labs-map
      id='main-map'
      initOptions=(hash
        style=projectMapForm.model.meta.mapboxStyle
        zoom=12
        center=(array -73.983307 40.704977)
      )
      mapLoaded=(action handleMapLoad) as |map|}}

      <div class="search-and-bbl-lookup-container">
        {{#labs-search
          searchPlaceholder='Search for Address...'
          onSelect=(action 'selectSearchResult')
          typeTitleLookup=(hash
            lot='Addresses')
          onClear=(action (mut geocodedFeature null)) as |search|}}
          <small class="dark-gray">{{search.result.label}}</small>
        {{/labs-search}}
        {{bbl-lookup flyTo=(action 'flyTo')}}
      </div>

      {{#if geocodedFeature}}
        {{#map.source options=geocodedFeature as |source|}}
          {{source.layer layer=geocodedLayer}}
        {{/map.source}}
      {{/if}}

        {{!-- labs-layers (includes tax-lots layer) --}}
        {{#map.labs-layers
          layerGroups=projectMapForm.model.layerGroups
          onLayerClick=(action 'handleLayerClick')
          as |layers|}}
            {{#layers.tooltip as |tooltip|}}
              {{tooltip-renderer feature=tooltip.feature template=tooltip.layer.tooltipTemplate}}
            {{/layers.tooltip}}
        {{/map.labs-layers}}

        {{!-- Ad-hoc source and layer for developmentSite --}}
        {{#if (and model.developmentSite (not-eq geometryMode "developmentSite"))}}
          {{#map.source options=(mapbox-geojson-source model.developmentSite) as |source|}}
            {{source.layer
              layer=projectGeomLayers.developmentSiteLayer
              before='boundary_country'
            }}
          {{/map.source}}
        {{/if}}

        {{!-- Ad-hoc source and layer for projectArea --}}
        {{#if (and model.projectArea (not-eq geometryMode "projectArea"))}}
          {{#map.source options=(mapbox-geojson-source model.projectArea) as |source|}}
            {{source.layer
              layer=projectGeomLayers.projectAreaLayer
              before='boundary_country'
            }}
          {{/map.source}}
        {{/if}}

        {{!-- Ad-hoc source and layer for projectArea --}}
        {{#if (and model.rezoningArea (not-eq geometryMode "rezoningArea"))}}
          {{#map.source options=(mapbox-geojson-source model.rezoningArea) as |source|}}
            {{source.layer
              layer=projectGeomLayers.rezoningAreaLayer
              before='boundary_country'
            }}
          {{/map.source}}
        {{/if}}

        {{!-- Ad-hoc source and layer for showing selected lots in lot selection mode --}}
        {{#map.source options=selectedLotsSource as |source|}}
          {{source.layer
            layer=selectedLotsLayer
            before='boundary_country'
          }}
        {{/map.source}}

        {{!-- Ad-hoc source and layer for showing proposed Zoning --}}
        {{#if (and model.proposedZoning (not-eq geometryMode "proposedZoning"))}}
          {{#map.source options=(mapbox-geojson-source model.proposedZoning) as |source|}}
            {{source.layer
              layer=projectGeomLayers.proposedZoningLayer
              before='boundary_country'
            }}
            {{source.layer
              layer=projectGeomLayers.proposedZoningLabelsLayer
              before='boundary_country'
            }}
          {{/map.source}}
        {{/if}}
    {{/labs-map}}
  {{/project-map-form}}
</div>
